<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard — Sujood</title>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&family=Amiri:wght@700&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <style>
    :root {
      --primary-dark: #064e3b;
      --primary-main: #10b981;
      --primary-light: #ecfdf5;
      --text-muted: #64748b;
      --bg-soft: #f8fafc;
      --sidebar-width: 80px;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: var(--bg-soft);
      color: #1e293b;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* --- SIDEBAR --- */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: var(--sidebar-width);
      background: var(--primary-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 2rem;
      padding-bottom: 2rem;
      z-index: 1000;
      box-shadow: 4px 0 20px rgba(0,0,0,0.1);
    }

    .sidebar-logo {
      background: white;
      color: var(--primary-dark);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.2rem;
      margin-bottom: 3rem;
    }

    .sidebar-link {
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.5rem;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      transition: all 0.2s;
      margin-bottom: 1rem;
      text-decoration: none;
      border: none;
      background: none;
      cursor: pointer;
    }

    .sidebar-link:hover, .sidebar-link.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
    }

    /* --- MAIN CONTENT --- */
    .main-content {
      margin-left: var(--sidebar-width);
      padding: 2rem;
      flex: 1; 
    }

    /* --- MOBILE RESPONSIVE --- */
    @media (max-width: 768px) {
      body { padding-bottom: 70px; }
      .sidebar {
        top: auto;
        bottom: 0;
        width: 100%;
        height: 70px;
        flex-direction: row;
        justify-content: space-evenly;
        padding: 0;
      }
      .sidebar-logo { display: none; }
      .sidebar-link { margin-bottom: 0; }
      .main-content { margin-left: 0; padding: 1.5rem; }
    }

    /* --- BUTTONS --- */
    .btn-primary-gradient {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-main) 100%);
      color: white;
      border: none;
      transition: all 0.2s;
    }
    .btn-primary-gradient:hover {
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.4);
    }

    /* --- CARDS --- */
    .card-modern {
      background: white;
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 30px -10px rgba(16, 185, 129, 0.15);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      height: 100%;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .highlight-box {
      background: linear-gradient(135deg, var(--primary-light) 0%, #d1fae5 100%);
      color: var(--primary-dark);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .text-muted-custom { color: var(--text-muted) !important; font-size: 0.9rem; }
    .hadith-preview { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.5; max-height: 4.5em; }
    .journal-entry { border-left: 3px solid var(--primary-main); background: var(--bg-soft); padding: 10px 15px; border-radius: 0 10px 10px 0; margin-bottom: 8px; }

    /* --- THIN GREY FOOTER --- */
    footer { 
        background-color: #111827; 
        color: #6b7280; 
        font-size: 0.75rem; 
        margin-left: var(--sidebar-width);
        padding: 8px 0; 
        border-top: 1px solid rgba(255,255,255,0.05);
    }
    @media (max-width: 768px) { footer { margin-left: 0; } }
  </style>
</head>

<body>

  <aside class="sidebar">
    <div class="sidebar-logo">
       <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">S</a></div>
    <a href="#" class="sidebar-link active" title="Dashboard"><i class="bi bi-grid-fill"></i></a>
    <a href="profile.html" class="sidebar-link" title="Profile"><i class="bi bi-person-fill"></i></a>
    <div style="flex-grow: 1;" class="d-none d-md-block"></div>
    <button onclick="" class="sidebar-link text-danger" data-bs-toggle="modal" data-bs-target="#logoutModal"  title="Logout"><i class="bi bi-box-arrow-right"></i></button>
     
  </aside>

  <div class="main-content">
    <div class="container-fluid p-0" style="max-width: 1200px; margin: 0 auto;">

      <div class="row align-items-center mb-5" data-aos="fade-down">
        <div class="col-md-7">
          <div class="d-flex align-items-center gap-3">
             <div class="text-muted-custom mb-1" id="day"><i class="bi bi-calendar-event me-2"></i>Loading date...</div>
             <button onclick="forceLocationCheck()" class="btn btn-sm btn-outline-success rounded-pill" style="font-size: 0.7rem;">
               <i class="bi bi-geo-alt-fill me-1"></i> Refresh Location
             </button>
          </div>
          <h2 class="fw-bold display-6 mb-0">Welcome back, <span style="color: var(--primary-main)" id="name"></span></h2>
        </div>
      </div>

      <div class="row gy-4">

        <div class="col-lg-8" data-aos="fade-up" data-aos-delay="100">
          <div class="card-modern d-flex flex-column justify-content-between">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <div><h5 class="fw-bold mb-1" id="schedule">Prayer Schedule</h5><div class="text-muted-custom">Synced for your location</div></div>
              <span class="badge bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill">Live Updates</span>
            </div>
            <div class="row g-4 align-items-center">
              <div class="col-md-4">
                <div class="highlight-box h-100 d-flex flex-column justify-content-center" id="next-prayer-box">
                  <div class="small fw-bold text-uppercase opacity-75 mb-1">Coming up</div>
                  <h3 class="fw-bold mb-0" id="next-prayer-name">Loading...</h3>
                  <div class="display-5 fw-bold my-1" id="next-prayer-time">--:--</div>
                  <div class="small fw-bold opacity-75" id="next-prayer-ampm">--</div>
                </div>
              </div>
              <div class="col-md-8">
                <div class="d-flex gap-2 justify-content-between mb-4 text-center" id="prayer-grid">
                  <div><div class="small text-muted">Fajr</div><div class="fw-bold" id="time-fajr">--:--</div></div>
                  <div><div class="small text-muted">Dhuhr</div><div class="fw-bold" id="time-dhuhr">--:--</div></div>
                  <div><div class="small text-muted">Asr</div><div class="fw-bold" id="time-asr">--:--</div></div>
                  <div><div class="small text-muted">Maghrib</div><div class="fw-bold" id="time-maghrib">--:--</div></div>
                  <div><div class="small text-muted">Isha</div><div class="fw-bold" id="time-isha">--:--</div></div>
                </div>
                <div class="row g-3">
                  <div class="col-6">
                    <div class="h-100 d-flex flex-column">
                      <div class="card border-0 shadow-sm h-100 overflow-hidden" style="border-radius: 16px; border: 1px solid rgba(0,0,0,0.08);">
                        <div class="bg-success text-white text-center py-2 fw-bold text-uppercase small ls-1" id="hijri-month">LOADING...</div>
                        <div class="bg-white flex-grow-1 d-flex flex-column align-items-center justify-content-center py-2">
                          <h1 class="display-4 fw-bold mb-0 text-dark" id="hijri-day" style="line-height: 1;">--</h1>
                          <small class="text-muted fw-bold" id="hijri-year">---- AH</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="p-3 border rounded-3 h-100 d-flex flex-column">
                      <div class="d-flex align-items-center gap-2 mb-2 text-primary"><i class="bi bi-quote"></i> <span class="small fw-bold text-dark">Daily Hadith</span></div>
                      <div class="small text-muted mb-2 hadith-preview flex-grow-1"><span id="daily-hadith">Loading hadith...</span></div>
                      <button class="btn btn-link p-0 text-decoration-none small text-success fw-bold align-self-start" data-bs-toggle="modal" data-bs-target="#hadithModal" style="font-size: 0.85rem;">Read full hadith <i class="bi bi-arrow-right"></i></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
          <div class="card-modern text-center d-flex flex-column align-items-center justify-content-center">
            <div class="bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
              <i class="bi bi-map-fill fs-1"></i>
            </div>
            <h4 class="fw-bold">Find Mosques</h4>
            <p class="text-muted small mb-4 px-3">Locate the nearest Masjids around your current location.</p>
            <a href="#" target="_blank" id="mosque-finder-btn" class="btn btn-primary-gradient w-100 py-3 rounded-4 shadow-sm fw-bold">
               <span id="btn-text"><div class="spinner-border spinner-border-sm me-2"></div> Locating you...</span>
            </a>
          </div>
        </div>

        <div class="col-lg-8" data-aos="fade-up" data-aos-delay="300">
          <div class="card-modern">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="fw-bold mb-0">I am feeling...</h5>
              <span class="badge bg-light text-muted border">Select an emotion</span>
            </div>
            <div class="d-flex flex-wrap gap-2 mb-4">
              <button onclick="getDua('anxious', this)" class="emotion-btn btn btn-light border rounded-pill btn-sm px-4">Anxious</button>
              <button onclick="getDua('sad', this)" class="emotion-btn btn btn-light border rounded-pill btn-sm px-4">Sad</button>
              <button onclick="getDua('confused', this)" class="emotion-btn btn btn-light border rounded-pill btn-sm px-4">Confused</button>
              <button onclick="getDua('happy', this)" class="emotion-btn btn btn-light border rounded-pill btn-sm px-4">Happy</button>
              <button onclick="getDua('lazy', this)" class="emotion-btn btn btn-light border rounded-pill btn-sm px-4">Lazy</button>
            </div>
            <div class="p-4 bg-light rounded-4 border d-flex flex-column justify-content-center flex-grow-1">
              <div id="dua-title" class="small text-uppercase text-success fw-bold mb-2 ls-1">Select an emotion</div>
              <p id="dua-arabic" class="lead fw-bold mb-2" style="font-family: 'Amiri', serif; font-size: 1.5rem;">...</p>
              <p id="dua-english" class="text-muted mb-0 fst-italic">Click a button above to see a Dua.</p>
            </div>
          </div>
        </div>

        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="400">
          <div class="card-modern">
            <h5 class="fw-bold mb-3"><i class="bi bi-calculator text-warning me-2"></i>Zakat Calculator</h5>
            <p class="small text-muted">Based on Gold Standard (Nisab ~₦17M).</p>
            <div class="input-group mb-3">
              <span class="input-group-text bg-light border-end-0">₦</span>
              <input type="number" id="asset-amount" class="form-control border-start-0" placeholder="0.00">
            </div>
            <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded-3 mb-3">
              <span class="small fw-bold text-muted">Payable:</span>
              <span class="fw-bold text-success fs-5"><span id="zakat-result">₦0.00</span></span>
            </div>
            <button onclick="calculateZakat()" class="btn btn-soft w-100 btn-sm">Calculate</button>
          </div>
        </div>

        <div class="col-md-6" data-aos="fade-up" data-aos-delay="500">
          <div class="card-modern h-100">
            <h5 class="fw-bold mb-3"><i class="bi bi-pen text-primary me-2"></i>Reflection Journal</h5>
            <textarea id="journal-input" class="form-control border bg-light mb-3" rows="2" placeholder="Today I am grateful for..."></textarea>
            <div class="d-flex justify-content-between align-items-center mb-4">
              <span id="save-msg" class="small text-success fw-bold opacity-0 transition-opacity">Saved!</span>
              <button onclick="saveJournal()" class="btn btn-dark btn-sm rounded-pill px-4">Save Entry</button>
            </div>
            <div class="border-top pt-3">
                <h6 class="small fw-bold text-muted text-uppercase ls-1 mb-3">Recent Entries</h6>
                <div id="journal-list" style="max-height: 200px; overflow-y: auto; padding-right: 5px;"></div>
            </div>
          </div>
        </div>

        <div class="col-md-6" data-aos="fade-up" data-aos-delay="600">
          <div class="card-modern text-center h-100">
             <h5 class="fw-bold mb-3"><i class="bi bi-lightbulb text-warning me-2"></i>Good Deed Generator</h5>
             <div class="bg-success bg-opacity-10 text-success p-4 rounded-4 mb-3 d-flex align-items-center justify-content-center flex-grow-1">
               <h4 class="fw-bold mb-0" id="deed-text" style="font-size: 1.25rem;">"Smile at a stranger today"</h4>
             </div>
             <button onclick="generateDeed()" class="btn btn-outline-success rounded-pill w-100">Suggest Another</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <footer>
    <div class="container text-center">
      <small>© 2025 Sujood. All rights reserved.</small>
    </div>
  </footer>

  <div class="modal fade" id="hadithModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
        <div class="modal-header border-bottom-0 pb-0">
          <h5 class="modal-title fw-bold text-success"><i class="bi bi-quote me-2"></i>Daily Hadith</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body pt-2">
          <h4 id="book"></h4><h6 id="book-name"></h6>
          <p class="lead text-dark" id="modal-hadith-content" style="font-size: 1.1rem; line-height: 1.8;">Loading...</p>
          <h6 id="refno"></h6>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 350px;">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 24px; overflow: hidden;">
      
      <div class="modal-body p-4 text-center">
        <div class="bg-danger bg-opacity-10 text-danger rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
             style="width: 60px; height: 60px;">
          <i class="bi bi-box-arrow-right fs-3"></i>
        </div>
        
        <h5 class="fw-bold mb-2">Log Out</h5>
        <p class="text-muted small mb-4">Are you sure you want to end your session?</p>
        
        <div class="d-flex gap-2 justify-content-center">
          <button type="button" class="btn btn-light rounded-pill px-4 fw-bold w-50" data-bs-dismiss="modal">Cancel</button>
          <button type="button" onclick="confirmLogout()" class="btn btn-danger rounded-pill px-4 fw-bold w-50">Log Out</button>
        </div>
      </div>

    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script>AOS.init({ duration: 800, once: true });</script>

  <script>
    // 1. BASIC SETUP
    // const currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};
    // if (currentUser.name) {
    // }

    const day = new Date();
    document.getElementById('day').innerHTML = `<i class="bi bi-calendar-event me-2"></i>${day.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`;
    document.getElementById('schedule').innerHTML="Prayer Schedule for " + day.toLocaleDateString('en-US', { month: 'long', day: 'numeric' ,year:'numeric'});

    // 2. GEOLOCATION - MANUAL & AUTO
    window.onload = function () {
      forceLocationCheck(); // Try automatically
      renderJournalList();
    };



    // --- PASTE THIS NEW FUNCTION HERE ---
    function forceLocationCheck() {
      // Show a loading state so you know it's working
      const btnText = document.getElementById('btn-text');
      if(btnText) btnText.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div> Warming up GPS...';

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(success, error, {
          enableHighAccuracy: false, 
          timeout: 30000,            
          maximumAge: Infinity      
        });
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }
  

    function success(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      
      console.log('Got Location:', lat, lon); // DEBUG CHECK

      // Update UI to prove we found it
      const mapBtn = document.getElementById('mosque-finder-btn');
      const btnText = document.getElementById('btn-text');
      btnText.innerHTML = `Find Mosques Near Me <i class="bi bi-box-arrow-up-right ms-2"></i>`;
      
      // Update Link
      mapBtn.href = `https://www.google.com/maps/search/mosques/@${lat},${lon},15z`;
      showNextPrayer(lat, lon);
      showHijriDate(lat, lon);
      loadHadith();
    }

    function error(err) {
      console.warn("Location Error:", err.code, err.message);
      // Show explicit alert so you know WHY it failed
      if (err.code === 1) alert("Location Denied. Please allow location permission in browser settings.");
      else if (err.code === 2) alert("Location Unavailable. GPS signal lost.");
      else alert("Location Timed Out.");
      
      const btnText = document.getElementById('btn-text');
      btnText.innerText = "Location Failed. Click to retry.";
    }

    // 3. ZAKAT LOGIC
    function calculateZakat() {
      const assets = document.getElementById('asset-amount').value;
      const nisab = 17000000;
      const resultEl = document.getElementById('zakat-result');
      
      if (assets >= nisab) {
        const zakat = (assets * 0.025).toLocaleString('en-NG', { style: 'currency', currency: 'NGN' });
        resultEl.innerText = zakat;
        resultEl.classList.remove('text-danger');
      } else {
        resultEl.innerText = "Below Nisab";
        resultEl.classList.add('text-danger');
      }
    }

    // 4. DUA LOGIC
    function getDua(mood, element) {
      const title = document.getElementById('dua-title');
      const arabic = document.getElementById('dua-arabic');
      const english = document.getElementById('dua-english');

      if (mood === 'anxious') {
        title.innerText = "Dua for Anxiety";
        arabic.innerText = "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ";
        english.innerText = "O Allah, I seek refuge in You from worry and grief.";
      } else if (mood === 'sad') {
        title.innerText = "Dua for Sadness";
        arabic.innerText = "إِنَّا لِلَّٰهِ وَإِنَّا إِلَيْهِ رَاجِعُونَ";
        english.innerText = "Indeed we belong to Allah, and indeed to Him we will return.";
      } else if (mood === 'confused') {
        title.innerText = "Dua for Guidance";
        arabic.innerText = "اللَّهُمَّ اهْدِنِي وَسَدِّدْنِي";
        english.innerText = "O Allah, guide me and direct me to the truth.";
      } else if (mood === 'happy') {
        title.innerText = "Dua for Gratitude";
        arabic.innerText = "الْحَمْدُ لِلَّهِ الَّذِي بِنِعْمَتِهِ تَتِمُّ الصَّالِحَاتُ";
        english.innerText = "Praise be to Allah, by Whose grace good deeds are completed.";
      } else if (mood === 'lazy') {
        title.innerText = "Dua for Laziness";
        arabic.innerText = "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْعَجْزِ وَالْكَسَلِ";
        english.innerText = "O Allah, I seek refuge in You from incapacity and laziness.";
      }

      document.querySelectorAll('.emotion-btn').forEach(btn => {
        btn.classList.remove('btn-dark');
        btn.classList.add('btn-light', 'border');
      });
      element.classList.remove('btn-light', 'border');
      element.classList.add('btn-dark');
    }

    // 5. JOURNAL LOGIC
    function saveJournal() {
      const text = document.getElementById('journal-input').value;
      if(!text.trim()) return;
      
      const entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
      entries.unshift({
          text: text,
          date: new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
      });
      localStorage.setItem('journalEntries', JSON.stringify(entries));
      
      document.getElementById('journal-input').value = '';
      const msg = document.getElementById('save-msg');
      msg.classList.remove('opacity-0');
      setTimeout(() => msg.classList.add('opacity-0'), 2000);
      renderJournalList();
    }

    function renderJournalList() {
        const entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
        const listContainer = document.getElementById('journal-list');
        if(entries.length === 0) {
            listContainer.innerHTML = '<div class="text-center text-muted small py-4">No entries yet.</div>';
            return;
        }
        let html = '';
        entries.forEach((entry, index) => {
            html += `
                <div class="journal-entry position-relative pe-4">
                    <div class="small text-muted mb-1" style="font-size: 0.75rem">${entry.date}</div>
                    <div class="small text-dark fw-medium">${entry.text}</div>
                    <button onclick="deleteEntry(${index})" class="btn btn-link text-danger p-0 position-absolute top-0 end-0 mt-2 me-2"><i class="bi bi-x-circle-fill"></i></button>
                </div>`;
        });
        listContainer.innerHTML = html;
    }

    function deleteEntry(index) {
        const entries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
        entries.splice(index, 1);
        localStorage.setItem('journalEntries', JSON.stringify(entries));
        renderJournalList();
    }

    // 6. DEED GENERATOR
    const goodDeeds = ["Smile at a stranger.", "Remove an obstacle.", "Call your parents.", "Feed a stray animal.", "Forgive someone.", "Read Surah Al-Ikhlas 3x.", "Give charity."];
    function generateDeed() {
      const random = Math.floor(Math.random() * goodDeeds.length);
      document.getElementById('deed-text').innerText = `"${goodDeeds[random]}"`;
    }

    // 7. API HELPERS
    async function getPrayerTimes(lat, lon) {
      const today = new Date();
      const newDay = `${String(today.getDate()).padStart(2, '0')}-${String(today.getMonth() + 1).padStart(2, '0')}-${today.getFullYear()}`;
      try {
        const response = await fetch(`https://api.aladhan.com/v1/timings/${newDay}?latitude=${lat}&longitude=${lon}&method=2`);
        const data = await response.json();
        const times = data.data.timings;
        
        document.getElementById("time-fajr").textContent = times.Fajr;
        document.getElementById("time-dhuhr").textContent = times.Dhuhr;
        document.getElementById("time-asr").textContent = times.Asr;
        document.getElementById("time-maghrib").textContent = times.Maghrib;
        document.getElementById("time-isha").textContent = times.Isha;
        
        return { times, hijri: data.data.date.hijri };
      } catch (err) { console.error(err); }
    }

    async function showHijriDate(lat, lon) {
      const result = await getPrayerTimes(lat, lon);
      if(result) {
        document.getElementById("hijri-month").textContent = result.hijri.month.en;
        document.getElementById("hijri-day").textContent = result.hijri.day;
        document.getElementById("hijri-year").textContent = result.hijri.year + " AH";
      }
    }
    
    async function showNextPrayer(lat, lon) {
      const result = await getPrayerTimes(lat, lon);
      if(!result) return;
      const times = result.times;
      const now = new Date();
      const prayerNames = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
      let next = "Fajr";
      for (let prayer of prayerNames) {
        const [h, m] = times[prayer].split(":").map(Number);
        const pDate = new Date(); pDate.setHours(h, m, 0, 0);
        if (pDate > now) { next = prayer; break; }
      }
      document.getElementById('next-prayer-name').textContent = next;
      document.getElementById('next-prayer-time').textContent = times[next];
      document.getElementById('next-prayer-ampm').textContent = (next === "Fajr") ? "AM" : "PM";
    }

    async function loadHadith() {
      try {
        const res = await fetch('https://random-hadith-generator.vercel.app/bukhari');
        const data = await res.json();
        document.getElementById("daily-hadith").innerText = data.data.hadith_english;
        document.getElementById("modal-hadith-content").innerText = data.data.hadith_english;
        document.getElementById("book").innerText = data.data.book;
        document.getElementById("book-name").innerText = data.data.bookName;
        document.getElementById("refno").innerText = data.data.refno;
      } catch (err) {}
    }
  </script>
     <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword , GoogleAuthProvider, signInWithPopup,onAuthStateChanged,signOut  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBe8v6EvUu2ewi_FDJvrpqdUx0t-anKsAA",
            authDomain: "sujood-868bf.firebaseapp.com",
            projectId: "sujood-868bf",
            storageBucket: "sujood-868bf.firebasestorage.app",
            messagingSenderId: "370785864080",
            appId: "1:370785864080:web:15c0ced9fea8e9e7fd0b15",
            measurementId: "G-R4PSSZT0YV"
        };

        const app = initializeApp(firebaseConfig);

const auth = getAuth(app);
onAuthStateChanged(auth, (user) => {
  console.log(user);
  
  if (user) {
    const uid = user.uid;
    console.log("User is signed in:", user);
    document.getElementById('name').textContent = user.displayName;

  } else {
    // window.location.href = "sign-up.html";
  }
});
function checkUser(){
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const uid = user.uid;
      console.log(user.displayName);
      document.getElementById('name').textContent = user.displayName;
    } else {
      window.location.href = "sign-up.html";
    }
  });
}
function confirmLogout(){
signOut(auth).then(() => {
  window.location.href = "sign-in.html";
}).catch((error) => {
  // An error happened.
});
}
window.confirmLogout = confirmLogout;
        </script>

</body>
</html>