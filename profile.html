<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Profile — Sujood</title>

	<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&display=swap"
		rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

	<style>
		:root {
			--primary-dark: #064e3b;
			--primary-main: #10b981;
			--primary-light: #ecfdf5;
			--text-muted: #64748b;
			--bg-soft: #f8fafc;
		}

		body {
			font-family: 'Plus Jakarta Sans', sans-serif;
			background-color: var(--bg-soft);
			color: #1e293b;
		}

		/* Navbar Glass Effect */
		.navbar-glass {
			background: rgba(6, 78, 59, 0.95);
			backdrop-filter: blur(10px);
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
		}

		.brand-text {
			font-weight: 800;
			letter-spacing: -0.5px;
			font-size: 1.25rem;
			color: white;
		}

		.logo-circle {
			background: white;
			color: #064e3b;
			width: 35px;
			height: 35px;
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 800;
		}

		/* Modern Card Style */
		.card-modern {
			background: white;
			border: 1px solid rgba(255, 255, 255, 0.6);
			border-radius: 24px;
			padding: 32px;
			box-shadow: 0 10px 30px -10px rgba(16, 185, 129, 0.1);
			margin-bottom: 24px;
		}

		/* Avatar Styling */
		.avatar-box {
			width: 110px;
			height: 110px;
			border-radius: 50%;
			background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #64748b;
			font-size: 52px;
			margin: 0 auto;
			border: 5px solid white;
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
		}

		/* Custom Buttons */
		.btn-primary-gradient {
			background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-main) 100%);
			color: white;
			border: none;
			transition: all 0.2s;
		}

		.btn-primary-gradient:hover {
			color: white;
			transform: translateY(-2px);
			box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.4);
		}

		/* Section Headings */
		.section-title {
			font-size: 0.85rem;
			text-transform: uppercase;
			letter-spacing: 1px;
			font-weight: 700;
			color: var(--text-muted);
			margin-bottom: 1rem;
			display: block;
		}

		/* Danger Zone */
		.card-danger {
			border: 1px solid rgba(220, 53, 69, 0.15);
			background: #fff5f5;
		}
	</style>
</head>

<body>

	<nav class="navbar navbar-expand-lg navbar-dark navbar-glass sticky-top py-3">
		<div class="container">
			<a class="navbar-brand d-flex align-items-center gap-2" href="dashboard.html">
				<span class="logo-circle">S</span>
				<span class="brand-text">Sujood</span>
			</a>
			<div class="ms-auto d-flex gap-2">
				<a href="dashboard.html" class="btn btn-sm btn-outline-light rounded-pill px-4">Dashboard</a>
			</div>
		</div>
	</nav>

	<main class="container py-5">
		<div class="row justify-content-center">
			<div class="col-lg-6 col-md-8">

				<div class="card-modern text-center position-relative">
					<div class="avatar-box mb-3">
						<i class="bi bi-person-fill"></i>
					</div>
					<h4 class="fw-bold mb-1" id="display-name">Loading...</h4>
					<div class="text-muted small mb-4" id="display-email">user@example.com</div>

					<button onclick="" class="btn btn-light rounded-pill border px-4 btn-sm text-danger fw-bold"
						data-bs-toggle="modal" data-bs-target="#logoutModal">
						<i class="bi bi-box-arrow-right me-2"></i>Log Out
					</button>
				</div>

				<span class="section-title ms-2">General Settings</span>
				<div class="card-modern">
					<div class="d-flex align-items-center mb-4">
						<div class="bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center me-3"
							style="width: 40px; height: 40px;">
							<i class="bi bi-person-lines-fill"></i>
						</div>
						<h5 class="fw-bold mb-0">Edit Profile</h5>
					</div>

					<form onsubmit="changeName(event)">
						<div class="mb-4">
							<label class="form-label small fw-bold text-muted">Full Name</label>
							<input type="text" id="input-name" class="form-control form-control-lg fs-6"
								placeholder="Enter your name">
						</div>
						<div class="d-grid">
							<button type="submit" class="btn btn-primary-gradient rounded-pill py-2 fw-bold"
								onclick="changeName()">Update
								Profile</button>
						</div>
					</form>
				</div>

				<span class="section-title ms-2">Security</span>
				<div class="card-modern">
					<div class="d-flex align-items-center mb-4">
						<div class="bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center me-3"
							style="width: 40px; height: 40px;">
							<i class="bi bi-key-fill"></i>
						</div>
						<h5 class="fw-bold mb-0">Change Password</h5>
					</div>

					<div>
						      <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted text-uppercase">Current
                                                Password</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control border-end-0"
                                                    placeholder="Input your current password" required id="currentpassword" />
                                                <span class="input-group-text bg-white border-start-0"
                                                    style="cursor: pointer;" onclick="togglePassword()">
                                                    <i class="bi bi-eye-slash" id="toggleIcon"></i>
                                                </span>
                                            </div>
                                        </div>
										      <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted text-uppercase">New
                                                Password</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control border-end-0"
                                                    placeholder="Input your new password" required id="newPassword" />
                                                <span class="input-group-text bg-white border-start-0"
                                                    style="cursor: pointer;" onclick="togglePassword()">
                                                    <i class="bi bi-eye-slash" id="toggleIcon"></i>
                                                </span>
                                            </div>
                                        </div>
										      <div class="mb-3">
                                            <label class="form-label small fw-bold text-muted text-uppercase">
                                               Confirm Password</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control border-end-0"
                                                    placeholder="Confirm your new password" required id="confirmPassword" />
                                                <span class="input-group-text bg-white border-start-0"
                                                    style="cursor: pointer;" onclick="togglePassword()">
                                                    <i class="bi bi-eye-slash" id="toggleIcon"></i>
                                                </span>
                                            </div>
                                        </div>
						<div class="d-grid">
							<button type="submit"
								class="btn btn-outline-dark rounded-pill py-2 fw-bold btn-primary-gradient"
								onclick="changePassword()" data-bs-toggle="modal"
								data-bs-target="#changePasswordModal">Update
								Password</button>
						</div>
					</div>
				</div>

				<span class="section-title ms-2 text-danger">Danger Zone</span>
				<div class="card-modern card-danger">
					<div class="d-flex align-items-start gap-3">
						<div class="text-danger fs-4 mt-1"><i class="bi bi-exclamation-triangle-fill"></i></div>
						<div>
							<h6 class="fw-bold text-danger mb-2">Delete Account</h6>
							<p class="small text-muted mb-3">Deleting your account is permanent. All your data will be
								wiped.</p>
							<button onclick=""
								class="btn btn-danger btn-sm rounded-pill px-4 fw-bold" data-bs-toggle="modal"
								data-bs-target="#deleteAccountModal">Yes, Delete My Account</button>
						</div>
					</div>
				</div>

			</div>
		</div>
	</main>
	<div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" style="max-width: 350px;">
			<div class="modal-content border-0 shadow-lg" style="border-radius: 24px; overflow: hidden;">

				<div class="modal-body p-4 text-center">
					<div class="bg-danger bg-opacity-10 text-danger rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
						style="width: 60px; height: 60px;">
						<i class="bi bi-box-arrow-right fs-3"></i>
					</div>

					<h5 class="fw-bold mb-2">Log Out</h5>
					<p class="text-muted small mb-4">Are you sure you want to end your session?</p>

					<div class="d-flex gap-2 justify-content-center">
						<button type="button" class="btn btn-light rounded-pill px-4 fw-bold w-50"
							data-bs-dismiss="modal">Cancel</button>
						<button type="button" onclick="confirmLogout()"
							class="btn btn-danger rounded-pill px-4 fw-bold w-50">Log Out</button>
					</div>
				</div>

			</div>
		</div>
	</div>

	<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" style="max-width: 350px;">
			<div class="modal-content border-0 shadow-lg" style="border-radius: 24px; overflow: hidden;">

				<div class="modal-body p-4 text-center">
					<div class="bg-success bg-opacity-10 text-success rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
						style="width: 60px; height: 60px;">
						<i class="bi bi-lock fs-3"></i>
					</div>

					<h5 class="fw-bold mb-2">Change Password</h5>
					<p class="text-muted small mb-4">Are you sure you want to change your password?</p>

					<div class="d-flex gap-2 justify-content-center">
						<button type="button" class="btn btn-light rounded-pill px-4 fw-bold w-50"
							data-bs-dismiss="modal" onclick="closePasswordModal()">Cancel</button>
						<button type="button" onclick="" class="btn btn-primary-gradient rounded-pill px-4 fw-bold w-50"
							id="modalUpdateBtn" onclick="handlePasswordUpdate()">Change</button>
					</div>
				</div>

			</div>
		</div>
	</div>

	<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" style="max-width: 350px;">
			<div class="modal-content border-0 shadow-lg" style="border-radius: 24px; overflow: hidden;">

				<div class="modal-body p-4 text-center">
					<div class="bg-danger bg-opacity-10 text-danger rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
						style="width: 60px; height: 60px;">
						<i class="bi bi-box-arrow-right fs-3"></i>
					</div>

					<h5 class="fw-bold mb-2">Delete Account</h5>
					<p class="text-muted small mb-4">Are you sure you want to delete your account?</p>

					<div class="d-flex gap-2 justify-content-center">
						<button type="button" class="btn btn-light rounded-pill px-4 fw-bold w-50"
							data-bs-dismiss="modal" onclick="closeAccountModal()">Cancel</button>
						<button type="button" onclick="confirmDeleteAccount()" class="btn btn-danger rounded-pill px-4 fw-bold w-50"
							id="modalUpdateBtn" id="deleteInput">Delete</button>
					</div>
				</div>

			</div>
		</div>
	</div>


	<footer class="py-4 text-center">
		<div class="container">
			<small class="text-muted">© 2025 Sujood. All rights reserved.</small>
		</div>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, updateProfile, updatePassword, EmailAuthProvider, reauthenticateWithCredential,deleteUser} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBe8v6EvUu2ewi_FDJvrpqdUx0t-anKsAA",
            authDomain: "sujood-868bf.firebaseapp.com",
            projectId: "sujood-868bf",
            storageBucket: "sujood-868bf.firebasestorage.app",
            messagingSenderId: "370785864080",
            appId: "1:370785864080:web:15c0ced9fea8e9e7fd0b15",
            measurementId: "G-R4PSSZT0YV"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // 1. AUTH STATE OBSERVER
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User is signed in:", user.email);
                document.getElementById('display-name').textContent = user.displayName || "User";
                document.getElementById('display-email').textContent = user.email;
                
                // Pre-fill the name input if it exists
                const nameInput = document.getElementById('input-name');
                if(nameInput) nameInput.value = user.displayName || "";
            } else {
                window.location.href = "sign-up.html";
            }
        });

        // 2. LOGOUT FUNCTION
        window.confirmLogout = function() {
            if(confirm("Are you sure you want to log out?")) {
                signOut(auth).then(() => {
                    window.location.href = "sign-in.html";
                }).catch((error) => {
                    console.error(error);
                });
            }
        }

        // 3. CHANGE NAME FUNCTION
        window.changeName = function(e) {
            e.preventDefault();
            const nameInput = document.getElementById('input-name');
            const newName = nameInput.value.trim();

            if (!newName) {
                alert("Please enter a valid name.");
                return;
            }

            updateProfile(auth.currentUser, {
                displayName: newName,
            }).then(() => {
                alert("Profile name updated!");
                document.getElementById('display-name').textContent = newName;
            }).catch((error) => {
                alert(error.message);
            });
        }

        // 4. HELPER: HANDLE PASSWORD UPDATE (Async Logic)
        async function handlePasswordUpdate(newPassword, credential) {
            const user = auth.currentUser;
            try {
                // Re-authenticate user to prove identity
                await reauthenticateWithCredential(user, credential);
                
                // Update Password
                await updatePassword(user, newPassword);
                
                alert('Password updated successfully.');
				document.getElementById('changePasswordModal').classList.add('hidden');
                
                // Clear form
                document.getElementById('currentPassword').value = "";
                document.getElementById('newPassword').value = "";
                document.getElementById('confirmNewPassword').value = "";
                
            } catch (error) {
                console.error("Update Error", error);
                if (error.code === 'auth/wrong-password') {
                    alert("Current password is incorrect.");
                } else if (error.code === 'auth/weak-password') {
                    alert("Password must be at least 6 characters long.");
                } else {
                    alert("Error: " + error.message);
                }
            }
        }

        // 5. CHANGE PASSWORD FUNCTION (Triggered by button)
        window.changePassword = function(e) {
            if(e) e.preventDefault();

            // Get Elements
            const currentPassInput = document.getElementById('currentPassword');
            const newPassInput = document.getElementById('newPassword');
            const confirmPassInput = document.getElementById('confirmNewPassword');

            // Get Values
            const currentVal = currentPassInput.value;
            const newVal = newPassInput.value;
            const confirmVal = confirmPassInput.value;

            // Validate
            if (!currentVal || !newVal || !confirmVal) {
                alert("Please fill in all password fields.");
                return;
            } 
            
            if (newVal !== confirmVal) {
                alert("New passwords do not match.");
                return;
            }

			

            const user = auth.currentUser;
            
            // Create Credential for Re-auth
            const credential = EmailAuthProvider.credential(
                user.email,
                currentVal 
            );

            // Call Helper
            handlePasswordUpdate(newVal, credential);
        }
		window.openPasswordModal = function() {
            const modal = document.getElementById('changePasswordModal');
                // If using Bootstrap class 'd-none' or custom 'hidden'
                modal.classList.remove('hidden'); 
		}

        window.closePasswordModal = function() {
            const modal = document.getElementById('changePasswordModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = "none"; // Force hide
            }
        }
		   window.closeAccountModal = function() {
            const modal = document.getElementById('deleteAccountModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = "none"; // Force hide
            }
        }
		function confirmDeleteAccount(){
			const user=auth.currentUser;
			// const userRef=ref(database,`users/${user.uid}`);
		
			deleteUser(user).then(()=>{
				alert('Account successfully deleted')
				window.location.href="index.html";
			}).catch((error)=>{
				console.error(error);

				if(error.code==="auth requires-recent-login"){
					alert("For security,log in again before deleting your account.")
				}
			})
		}
		window.confirmDeleteAccount = confirmDeleteAccount;
		 window.togglePassword = function() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('toggleIcon');

        if (passwordInput.type === 'password') {
            passwordInput.type = 'text'; 
            toggleIcon.classList.remove('bi-eye-slash');
            toggleIcon.classList.add('bi-eye');
        } else {
            passwordInput.type = 'password'; 
            toggleIcon.classList.remove('bi-eye');
            toggleIcon.classList.add('bi-eye-slash');
        }
    }
    </script>

</body>

</html>